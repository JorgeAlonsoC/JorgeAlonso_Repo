<!doctype html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Assistant - LLM Chat Interface</title>
    <meta name="description" content="Interactive AI chat interface for LLM conversations" />
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        background: 'hsl(240 10% 3.9%)',
                        foreground: 'hsl(0 0% 98%)',
                        card: 'hsl(240 10% 3.9%)',
                        'card-foreground': 'hsl(0 0% 98%)',
                        primary: 'hsl(263 70% 50%)',
                        'primary-foreground': 'hsl(0 0% 98%)',
                        secondary: 'hsl(240 3.7% 15.9%)',
                        'secondary-foreground': 'hsl(0 0% 98%)',
                        muted: 'hsl(240 3.7% 15.9%)',
                        'muted-foreground': 'hsl(240 5% 64.9%)',
                        border: 'hsl(240 3.7% 15.9%)',
                        input: 'hsl(240 3.7% 15.9%)',
                        'ai-primary': 'hsl(263 70% 50%)',
                        'ai-secondary': 'hsl(252 56% 57%)',
                        'ai-glow': 'hsl(263 70% 50%)',
                    },
                    backgroundImage: {
                        'gradient-ai': 'linear-gradient(135deg, hsl(263 70% 50%), hsl(252 56% 57%))',
                        'gradient-glow': 'linear-gradient(135deg, hsl(263 70% 50% / 0.1), hsl(252 56% 57% / 0.1))',
                    },
                    animation: {
                        'glow': 'glow 2s ease-in-out infinite',
                        'fade-in': 'fade-in 0.6s ease-out',
                        'spin': 'spin 1s linear infinite',
                    },
                    keyframes: {
                        glow: {
                            '0%, 100%': { boxShadow: '0 0 20px hsl(263 70% 50% / 0.3)' },
                            '50%': { boxShadow: '0 0 40px hsl(263 70% 50% / 0.6), 0 0 60px hsl(263 70% 50% / 0.4)' },
                        },
                        'fade-in': {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        body {
            background-color: hsl(240 10% 3.9%);
            color: hsl(0 0% 98%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .btn-ai {
            background: linear-gradient(135deg, hsl(263 70% 50%), hsl(252 56% 57%));
            color: hsl(0 0% 98%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 14px 0 hsl(263 70% 50% / 0.39);
        }
        
        .btn-ai:hover {
            opacity: 0.9;
            box-shadow: 0 6px 20px hsl(263 70% 50% / 0.5);
        }
        
        .btn-ai:disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        
        .message-user {
            background-color: hsl(263 70% 50%);
            color: hsl(0 0% 98%);
        }
        
        .message-assistant {
            background-color: hsl(240 10% 3.9%);
            border: 1px solid hsl(240 3.7% 15.9%);
        }
        
        .input-field {
            background-color: hsl(240 10% 3.9%);
            border: 1px solid hsl(240 3.7% 15.9%);
            color: hsl(0 0% 98%);
        }
        
        .input-field:focus {
            outline: none;
            border-color: hsl(263 70% 50%);
            box-shadow: 0 0 0 2px hsl(263 70% 50% / 0.2);
        }
        
        .loading-dots::after {
            content: '';
            animation: dots 1.5s infinite;
        }
        
        @keyframes dots {
            0% { content: ''; }
            33% { content: '.'; }
            66% { content: '..'; }
            100% { content: '...'; }
        }
    </style>
</head>

<body>
    <div id="app" class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="border-b border-gray-700 bg-black/50 backdrop-blur-sm">
            <div class="container mx-auto px-4 py-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 rounded-lg bg-gradient-ai animate-glow">
                        <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold bg-gradient-ai bg-clip-text text-transparent">
                            AI Assistant
                        </h1>
                        <p class="text-gray-400">Pregúntame cualquier cosa</p>
                    </div>
                </div>
            </div>
        </header>

        <!-- Chat Messages -->
        <div class="flex-1 container mx-auto px-4 py-6 max-w-4xl">
            <div id="messages" class="space-y-6">
                <!-- Welcome Message -->
                <div id="welcome" class="text-center py-12">
                    <div class="p-4 rounded-full bg-gradient-glow w-fit mx-auto mb-4">
                        <svg class="h-12 w-12 text-ai-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <h2 class="text-xl font-semibold mb-2">Bienvenido al AI Assistant</h2>
                    <p class="text-gray-400">
                        Inicia una conversación escribiendo tu pregunta abajo
                    </p>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="border-t border-gray-700 bg-black/50 backdrop-blur-sm">
            <div class="container mx-auto px-4 py-4 max-w-4xl">
                <div class="flex gap-3">
                    <input
                        id="questionInput"
                        type="text"
                        placeholder="Escribe tu pregunta aquí..."
                        class="flex-1 px-4 py-3 rounded-lg input-field"
                    />
                    <button
                        id="sendButton"
                        class="btn-ai px-6 py-3 rounded-lg font-medium flex items-center gap-2"
                    >
                        <svg id="sendIcon" class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                        </svg>
                        <svg id="loadingIcon" class="h-4 w-4 animate-spin hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        Enviar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isLoading = false;
        const messagesContainer = document.getElementById('messages');
        const welcomeDiv = document.getElementById('welcome');
        const questionInput = document.getElementById('questionInput');
        const sendButton = document.getElementById('sendButton');
        const sendIcon = document.getElementById('sendIcon');
        const loadingIcon = document.getElementById('loadingIcon');

        function addMessage(type, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex gap-4 animate-fade-in ${type === 'user' ? 'justify-end' : 'justify-start'}`;
            
            const timestamp = new Date().toLocaleTimeString();
            
            messageDiv.innerHTML = `
                ${type === 'assistant' ? `
                    <div class="p-2 rounded-lg bg-gradient-ai shrink-0">
                        <svg class="h-5 w-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                    </div>
                ` : ''}
                
                <div class="max-w-[80%] p-4 rounded-lg ${type === 'user' ? 'message-user' : 'message-assistant'}">
                    <p class="whitespace-pre-wrap">${content}</p>
                    <span class="text-xs opacity-70 mt-2 block">${timestamp}</span>
                </div>

                ${type === 'user' ? `
                    <div class="p-2 rounded-lg bg-gray-600 shrink-0">
                        <svg class="h-5 w-5 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                    </div>
                ` : ''}
            `;
            
            if (welcomeDiv) {
                welcomeDiv.remove();
            }
            
            messagesContainer.appendChild(messageDiv);
            messageDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function addLoadingMessage() {
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loading-message';
            loadingDiv.className = 'flex gap-4 animate-fade-in';
            loadingDiv.innerHTML = `
                <div class="p-2 rounded-lg bg-gradient-ai shrink-0">
                    <svg class="h-5 w-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                    </svg>
                </div>
                <div class="max-w-[80%] p-4 rounded-lg message-assistant">
                    <div class="flex items-center gap-2">
                        <svg class="h-4 w-4 animate-spin text-ai-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        <span class="text-gray-400">Pensando<span class="loading-dots"></span></span>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(loadingDiv);
            loadingDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function removeLoadingMessage() {
            const loadingMessage = document.getElementById('loading-message');
            if (loadingMessage) {
                loadingMessage.remove();
            }
        }

        function setLoadingState(loading) {
            isLoading = loading;
            sendButton.disabled = loading;
            questionInput.disabled = loading;
            
            if (loading) {
                sendIcon.classList.add('hidden');
                loadingIcon.classList.remove('hidden');
            } else {
                sendIcon.classList.remove('hidden');
                loadingIcon.classList.add('hidden');
            }
        }

        async function sendQuestion() {
            const question = questionInput.value.trim();
            if (!question || isLoading) return;

            // Add user message
            addMessage('user', question);
            
            // Show loading state
            setLoadingState(true);
            addLoadingMessage();
            
            try {
                // Cambia esta URL por la de tu endpoint de Flask
                const response = await fetch('/api/llm', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ question }),
                });

                if (!response.ok) {
                    throw new Error('Error al obtener respuesta del LLM');
                }

                const data = await response.json();
                
                // Remove loading message
                removeLoadingMessage();
                
                // Add assistant response
                const assistantResponse = data.response || data.answer || "No se recibió respuesta";
                addMessage('assistant', assistantResponse);
                
                // Clear input
                questionInput.value = '';
                
            } catch (error) {
                console.error('Error:', error);
                removeLoadingMessage();
                addMessage('assistant', 'Error: No se pudo obtener respuesta del LLM. Por favor, intenta de nuevo.');
            } finally {
                setLoadingState(false);
            }
        }

        // Event listeners
        sendButton.addEventListener('click', sendQuestion);

        questionInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendQuestion();
            }
        });

        // Auto-focus input
        questionInput.focus();
    </script>
</body>
</html>
